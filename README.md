# Post-up-MAP-Data-and-Image-to-Cloud-DB-via-REST
Upload Local Table Data to Cloud DB by using Oracle APEX

# Scenario : 
The universtiy asked the students to develop a map page containing information about the universtiy's location and pictures that existed in the universtiy's local database, and wanted to share the map with the incoming students, so they wanted to upload the data to the cloud so that everyone could easily view it through the map. 


# Solution (By using Oracle APEX Service in Oracle CLoud) : 

1. Create the same table structure in Oracle Cloud Database as the local tables.

```
CREATE TABLE  "MAP_DATA" 
   (	"ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NAME" VARCHAR2(100) COLLATE "USING_NLS_COMP", 
	"CITY" VARCHAR2(50) COLLATE "USING_NLS_COMP", 
	"REGION" VARCHAR2(50) COLLATE "USING_NLS_COMP", 
	"LOCATION" VARCHAR2(50) COLLATE "USING_NLS_COMP", 
	"VENUE" VARCHAR2(50) COLLATE "USING_NLS_COMP", 
	"LATITUDE" NUMBER, 
	"LONGITUDE" NUMBER, 
	 PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   )  DEFAULT COLLATION "USING_NLS_COMP"
/

CREATE TABLE  "VENUE" 
   (	"ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NAME" VARCHAR2(100) COLLATE "USING_NLS_COMP" NOT NULL ENABLE, 
	"IMAGE" BLOB, 
	"IMAGE_NAME" VARCHAR2(250) COLLATE "USING_NLS_COMP", 
	"MIMETYPE" VARCHAR2(250) COLLATE "USING_NLS_COMP", 
	"NOTES" VARCHAR2(50) COLLATE "USING_NLS_COMP", 
	 PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   )  DEFAULT COLLATION "USING_NLS_COMP"
/
```

2. Create Module / Resource / Handler by using APEX RESTful Data Services in Oracle Cloud

1) The first URI is MAP_DAT 

Method: POST \
Source Type: PL/SQL \
Mime Types Allowed: application/json

Source:

```
declare
l_body clob := :body_text;
begin
if :key='your key' then
    delete from map_data;
    insert into map_data (name,city,region,location,venue,latitude,longitude) 
    select name,city,region,location,venue,latitude,longitude
    from json_table ( 
            l_body, '$[*]'
          columns ( 
                name,city,region,location,venue,latitude,longitude
          )
        );
    commit;
end if;
:output := 201;
exception
    when others then
        :output := 400;
end;
```

Parameters:

|Name  |Bind Variable|Access Method|Source Type|Data Type|Comments|
|------|-------------|-------------|-----------|---------|--------|
|key   |key          |IN           |HTTP HEADER|STRING   |        |
|output|output       |OUT          |HTTP HEADER|INTEGER  |        |






2) The second URI is VENUE 

Method: POST \
Source Type: PL/SQL \
Mime Types Allowed: application/json

Source:
```
declare
l_body clob := :body_text;
begin
if :key='your key' then
    insert into venue (name,image,image_name,mimetype,notes) 
    select name,apex_web_service.clobbase642blob(image) image,image_name,mimetype,notes
    from json_table ( 
            l_body, '$[*]'
          columns ( 
                name, 
                image clob,
                image_name,
                mimetype,
                notes
          )
        );
    commit;
end if;
:output := 201;
exception
    when others then
        :output := 400;
end;
```

Parameters:

|Name  |Bind Variable|Access Method|Source Type|Data Type|Comments|
|------|-------------|-------------|-----------|---------|--------|
|key   |key          |IN           |HTTP HEADER|STRING   |        |
|output|output       |OUT          |HTTP HEADER|INTEGER  |        |

3. Write the PL/SQL process in the local APEX page so that the user can click the submit button to upload the data.

Upload MAP_DATA process

```
declare
l_clob clob;
l_body_clob clob;
begin
    apex_web_service.g_request_headers.delete();
    apex_web_service.g_request_headers(1).name := 'key';
    apex_web_service.g_request_headers(1).value := 'your key';
    apex_web_service.g_request_headers(2).name := 'content-type';
    apex_web_service.g_request_headers(2).value := 'application/json';
    
    select json_arrayagg(json_object(name,city,region,location,venue,latitude,longitude) returning clob) 
    into l_body_clob 
    from map_data;
  
    l_clob := apex_web_service.make_rest_request(
	    p_url         => 'your oracle cloud full url',
	    p_http_method => 'post',
	    p_body=> l_body_clob
    );
end;
```

Upload VENUE process

```
declare
l_clob clob;
l_body_clob clob;
begin
    apex_web_service.g_request_headers.delete();
    apex_web_service.g_request_headers(1).name := 'pwd';
    apex_web_service.g_request_headers(1).value := 'your key';
    apex_web_service.g_request_headers(2).name := 'content-type';
    apex_web_service.g_request_headers(2).value := 'application/json';
    select json_arrayagg(json_object(name,'image' value apex_web_service.blob2clobbase64(image) returning clob,image_name,mimetype,notes) returning clob) 
    into l_body_clob
    from venue ;
  
    l_clob := apex_web_service.make_rest_request(
	    p_url         => 'your oracle cloud full url',
	    p_http_method => 'post',
	    p_body=> l_body_clob
    );
end;

```

5. The MAP Show


Enjoy!  :)


